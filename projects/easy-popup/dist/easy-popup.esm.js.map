{"version":3,"file":"easy-popup.esm.js","sources":["../src/portal.tsx","../src/types.ts","../src/popup.tsx"],"sourcesContent":["import { useRef, useEffect } from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport { PortalProps } from './types'\r\nimport PropTypes from 'prop-types'\r\n\r\n// Determines whether it is a browser environment\r\nconst canUseDOM = !!(\r\n  typeof window !== 'undefined' &&\r\n  window.document &&\r\n  window.document.createElement\r\n)\r\n\r\nconst Portal = ({ node, children }: PortalProps) => {\r\n  const defaultNodeRef = useRef<HTMLElement | null>(null)\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (defaultNodeRef.current) {\r\n        document.body.removeChild(defaultNodeRef.current)\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  if (!canUseDOM) return null\r\n\r\n  if (!node && !defaultNodeRef.current) {\r\n    const defaultNode = document.createElement('div')\r\n    defaultNode.classList.add('easy-popup__portal')\r\n    defaultNodeRef.current = defaultNode\r\n    document.body.appendChild(defaultNode)\r\n  }\r\n\r\n  return ReactDOM.createPortal(children, node || defaultNodeRef.current!)\r\n}\r\n\r\nPortal.propTypes = {\r\n  node: canUseDOM ? PropTypes.instanceOf(HTMLElement) : PropTypes.any,\r\n  children: PropTypes.node,\r\n}\r\n\r\nexport default Portal\r\n","import { string } from 'prop-types'\r\n\r\nexport const positions = ['top', 'right', 'bottom', 'left', 'center'] as const\r\n\r\nexport type Positions = typeof positions[number]\r\n\r\nexport type PortalProps = React.PropsWithChildren<{\r\n  node?: HTMLElement\r\n}>\r\n\r\nexport type PopupProps = React.PropsWithChildren<\r\n  { node?: HTMLElement }\r\n  & typeof defaultProps\r\n>\r\n\r\nexport const defaultProps = {\r\n  visible: false,\r\n  position: \"center\" as Positions,\r\n  mask: true,\r\n  maskClosable: false,\r\n  customClassName: string,\r\n  onClose: () => { },\r\n  destroyOnClose: false,\r\n}\r\n","import React, { useRef } from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport { CSSTransition } from 'react-transition-group'\r\nimport classnames from 'classnames'\r\nimport Portal from './portal'\r\nimport { PopupProps, defaultProps, positions, Positions } from './types'\r\nimport './index.scss'\r\n\r\n// Class name prefix\r\nconst prefixCls = 'easy-popup'\r\n// Animation duration\r\nconst duration = 300\r\n// Mapping of animations\r\nconst animations: { [key in Positions]: string } = {\r\n  bottom: `${prefixCls}-slide-up`,\r\n  right: `${prefixCls}-slide-left`,\r\n  left: `${prefixCls}-slide-right`,\r\n  top: `${prefixCls}-slide-down`,\r\n  center: `${prefixCls}-fade`,\r\n}\r\n\r\nconst Popup = (props: PopupProps) => {\r\n  // DOM will not mount until 'visible' first time becomes 'true'\r\n  const firstRenderRef = useRef(false)\r\n\r\n  const { visible } = props\r\n\r\n  if (!firstRenderRef.current && !visible) return null\r\n  if (!firstRenderRef.current) {\r\n    firstRenderRef.current = true\r\n  }\r\n\r\n  const {\r\n    node,\r\n    mask,\r\n    maskClosable,\r\n    onClose,\r\n    customClassName,\r\n    position,\r\n    destroyOnClose,\r\n    children,\r\n  } = props\r\n\r\n  // 蒙层点击事件\r\n  const onMaskClick = () => {\r\n    if (maskClosable) {\r\n      onClose()\r\n    }\r\n  }\r\n\r\n  // 拼接容器节点类名\r\n  const rootCls = classnames(\r\n    prefixCls,\r\n    customClassName,\r\n    `${prefixCls}__${position}`\r\n  )\r\n\r\n  // 拼接蒙层节点类名\r\n  const maskCls = classnames(`${prefixCls}-mask`, {\r\n    [`${prefixCls}-mask--visible`]: mask,\r\n  })\r\n\r\n  // 拼接内容节点类名\r\n  const contentCls = classnames(\r\n    `${prefixCls}-content`,\r\n    `${prefixCls}-content__${position}`\r\n  )\r\n\r\n  // 内容过渡动画\r\n  const contentAnimation = animations[position]\r\n\r\n  return (\r\n    <Portal node={node}>\r\n      <div className={rootCls}>\r\n        <CSSTransition\r\n          in={visible}\r\n          timeout={duration}\r\n          classNames={`${prefixCls}-fade`}\r\n          appear\r\n        >\r\n          <div className={maskCls} onClick={onMaskClick}></div>\r\n        </CSSTransition>\r\n        <CSSTransition\r\n          in={visible}\r\n          timeout={duration}\r\n          classNames={contentAnimation}\r\n          unmountOnExit={destroyOnClose}\r\n          appear\r\n        >\r\n          <div className={contentCls}>{children}</div>\r\n        </CSSTransition>\r\n      </div>\r\n    </Portal>\r\n  )\r\n}\r\n\r\nPopup.propTypes = {\r\n  visible: PropTypes.bool,\r\n  position: PropTypes.oneOf(positions),\r\n  mask: PropTypes.bool,\r\n  maskClosable: PropTypes.bool,\r\n  onClose: PropTypes.func,\r\n  destroyOnClose: PropTypes.bool,\r\n  stopScrollUnderMask: PropTypes.bool,\r\n}\r\n\r\nPopup.defaultProps = defaultProps\r\n\r\nexport default Popup\r\n"],"names":["canUseDOM","window","document","createElement","Portal","node","children","defaultNodeRef","useRef","useEffect","current","body","removeChild","defaultNode","classList","add","appendChild","ReactDOM","createPortal","propTypes","PropTypes","instanceOf","HTMLElement","any","positions","defaultProps","visible","position","mask","maskClosable","customClassName","string","onClose","destroyOnClose","prefixCls","duration","animations","bottom","right","left","top","center","Popup","props","firstRenderRef","onMaskClick","rootCls","classnames","maskCls","contentCls","contentAnimation","React","className","CSSTransition","in","timeout","classNames","appear","onClick","unmountOnExit","bool","oneOf","func","stopScrollUnderMask"],"mappings":"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"}